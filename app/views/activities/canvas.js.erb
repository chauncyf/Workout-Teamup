;(function () {
    poster = $('.poster[data-poster=<%= activity_id %>]')[0]

    html2canvas(poster, {
        dpi: 300,
//        scale: 3,
        useCORS: true,
        letterRendering: true,
        onrendered: getPdf})

    new PNotify({
        title: '<i class="fas fa-check-circle"></i> Poster Saved',
        type: 'success'
    });
})()

function getPdf(canvas) {
    var ctx = canvas.getContext('2d');
    ctx.webkitImageSmoothingEnabled = false;
    ctx.mozImageSmoothingEnabled = false;
    ctx.imageSmoothingEnabled = false;

//         Export the canvas to its data URI representation
    var poster_image = canvas.toDataURL("image/png", 1.0);

    var qrcode_canvas = document.createElement('canvas')
    canvg(qrcode_canvas, `<%= raw qrcode.as_svg %>`)
    var qrcode_image = qrcode_canvas.toDataURL("image/png", 1.0)

    var doc = new jsPDF()

//    doc.internal.scaleFactor = 1.8;


    doc.setFontSize(30)
    doc.text(20, 30, 'Scan QR Code To Join Activity!')
    doc.addImage(poster_image, 'PNG', 20, 50)
    doc.addImage(qrcode_image, 'PNG', 130, 50, 50, 50)

    doc.save(`poster_<%= activity_id %>.pdf`)
//    downloadURI(poster_image, `poster_<%= activity_id %>.jpg`)
}

function downloadURI(uri, name) {
    var link = document.createElement("a");
    link.download = name;
    link.href = uri;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
